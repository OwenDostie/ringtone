<!doctype html>
<h2>RINGTONE</h2>
<label for="fname">enter your name:</label>
<input type="text" id="fname" name="fname"><br><br>
<label for="lobbieId">enter the lobbie id:</label>
<input type="text" id="lobbieId" name="lobbieId">
<button onclick="onClickJoinLobby()" type="button">join lobbie!</button> <br><br>
<button onclick="onClickHost()" type="button">host a lobbie!</button> 
<div id="output"></div>
<script>
  const wsUri = "ws://127.0.0.1/";
  const output = document.querySelector("#output");
  const websocket = new WebSocket(wsUri);
  let pingInterval;

  function writeToScreen(message) {
    output.insertAdjacentHTML("afterbegin", `<p>${message}</p>`);
  }

  function sendMessage(message) {
    writeToScreen(`SENT: ${message}`);
    websocket.send(message);
  }

  function onClickJoinLobby() {
    const msg = {
        type: "join_request",
        user_name: document.getElementById("fname").value,
        lobbie_code: document.getElementById("lobbieId").value,
        date: Date.now(),
    }
    writeToScreen(`tryna JOIN UP lobbie ${msg.lobbie_code}`);
    websocket.send(JSON.stringify(msg));
  }

  function onClickHost() {
    const msg = {
        type: "host_request",
        hoster_name: document.getElementById("fname").value,
        date: Date.now(),
    }
    writeToScreen(`sent my name to teh server :3}`);
    websocket.send(JSON.stringify(msg));
  }

  websocket.onopen = (e) => {
    writeToScreen("CONNECTED");
  };

  websocket.onclose = (e) => {
    writeToScreen("DISCONNECTED");
    clearInterval(pingInterval);
  };

  websocket.onmessage = (e) => {
    writeToScreen(`RECEIVED: ${e.data}`);
  };

  websocket.onerror = (e) => {
    writeToScreen(`ERROR: ${e.data}`);
  };
</script>
